<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Health Tracker Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <div class="d-flex justify-content-between align-items-center mt-3 mb-4">
      <h2>ğŸ‹ï¸â€â™€ï¸ Welcome, <span id="userDisplay"></span></h2>
      <button id="logoutBtn" class="btn btn-outline-danger">Logout</button>
    </div>

    <!-- Progress Overview -->
    <div class="card p-3 mb-4">
      <h5>Daily Progress</h5>
      <div class="mb-2">ğŸ’§ Water (Goal: 3000ml)
        <div class="progress"><div id="waterProg" class="progress-bar bg-info" style="width:0%">0%</div></div>
      </div>
      <div class="mb-2">ğŸš¶ Steps (Goal: 8000)
        <div class="progress"><div id="stepsProg" class="progress-bar bg-success" style="width:0%">0%</div></div>
      </div>
      <div class="mb-2">ğŸ˜´ Sleep (Goal: 8hrs)
        <div class="progress"><div id="sleepProg" class="progress-bar bg-primary" style="width:0%">0%</div></div>
      </div>
      <div class="mb-2">ğŸ”¥ Calories (Goal: 2000kcal)
        <div class="progress"><div id="calProg" class="progress-bar bg-warning" style="width:0%">0%</div></div>
      </div>
    </div>

    <!-- Health Form -->
    <div class="card p-3 mb-4">
      <form id="logForm" class="row g-2">
        <div class="col-md-3"><input type="date" id="date" class="form-control" required></div>
        <div class="col-md-2"><input type="number" id="water" class="form-control" placeholder="Water (ml)" min="0" required></div>
        <div class="col-md-2"><input type="number" id="steps" class="form-control" placeholder="Steps" min="0"></div>
        <div class="col-md-2"><input type="number" id="sleep" class="form-control" placeholder="Sleep (hrs)" step="0.1" min="0"></div>
        <div class="col-md-2"><input type="number" id="calories" class="form-control" placeholder="Calories (kcal)" min="0"></div>
        <div class="col-md-1"><button class="btn btn-primary w-100" type="submit">Add</button></div>
      </form>
    </div>

    <!-- Charts -->
    <div class="row">
      <div class="col-md-6 mb-4"><div class="card p-3"><h5>Water Intake</h5><canvas id="waterChart"></canvas></div></div>
      <div class="col-md-6 mb-4"><div class="card p-3"><h5>Steps</h5><canvas id="stepsChart"></canvas></div></div>
    </div>

    <!-- Logged Data -->
    <div class="card p-3 mb-4">
      <h5>History</h5>
      <table class="table table-sm" id="dataTable">
        <thead><tr><th>Date</th><th>Water</th><th>Steps</th><th>Sleep</th><th>Calories</th><th></th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

<script>
const activeUser = localStorage.getItem('activeUser');
if(!activeUser){ window.location.href='index.html'; }

document.getElementById('userDisplay').textContent = activeUser;
document.getElementById('logoutBtn').addEventListener('click', ()=>{ 
  localStorage.removeItem('activeUser'); window.location.href='index.html'; 
});

let logs = JSON.parse(localStorage.getItem(`healthLogs_${activeUser}`) || '[]');
function save(){ localStorage.setItem(`healthLogs_${activeUser}`, JSON.stringify(logs)); }

const form = document.getElementById('logForm');
const dateInput = document.getElementById('date');
function formatDate(d){ return new Date(d).toISOString().slice(0,10); }

function renderTable(){
  const tbody = document.querySelector('#dataTable tbody');
  tbody.innerHTML = '';
  logs.slice().reverse().forEach((l,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${l.date}</td><td>${l.water}</td><td>${l.steps}</td><td>${l.sleep}</td><td>${l.calories}</td>
    <td><button class='btn btn-sm btn-outline-danger del' data-i='${i}'>Delete</button></td>`;
    tbody.appendChild(tr);
  });
}

const waterChart = new Chart(document.getElementById('waterChart'), { type:'line', data:{labels:[],datasets:[{label:'Water (ml)',data:[],borderColor:'#0d6efd'}]} });
const stepsChart = new Chart(document.getElementById('stepsChart'), { type:'bar', data:{labels:[],datasets:[{label:'Steps',data:[],backgroundColor:'#198754'}]} });

function updateCharts(){
  const sorted = logs.slice().sort((a,b)=>a.date.localeCompare(b.date));
  const labels = sorted.map(x=>x.date);
  waterChart.data.labels = labels;
  stepsChart.data.labels = labels;
  waterChart.data.datasets[0].data = sorted.map(x=>x.water);
  stepsChart.data.datasets[0].data = sorted.map(x=>x.steps);
  waterChart.update(); stepsChart.update();
}

function updateProgress(){
  if(!logs.length) return;
  const today = logs[logs.length-1];
  const percent = (val, goal)=> Math.min(100, Math.round((val/goal)*100));
  document.getElementById('waterProg').style.width = percent(today.water,3000)+'%';
  document.getElementById('stepsProg').style.width = percent(today.steps,8000)+'%';
  document.getElementById('sleepProg').style.width = percent(today.sleep,8)+'%';
  document.getElementById('calProg').style.width = percent(today.calories,2000)+'%';
}

form.addEventListener('submit', e=>{
  e.preventDefault();
  const entry = {
    date: formatDate(dateInput.value || new Date()),
    water: Number(water.value)||0,
    steps: Number(steps.value)||0,
    sleep: Number(sleep.value)||0,
    calories: Number(calories.value)||0
  };
  const idx = logs.findIndex(x=>x.date===entry.date);
  if(idx>=0) logs[idx]=entry; else logs.push(entry);
  save(); renderTable(); updateCharts(); updateProgress(); form.reset();
});

document.querySelector('#dataTable tbody').addEventListener('click', e=>{
  if(e.target.classList.contains('del')){
    const i = e.target.dataset.i;
    const real = logs.length - 1 - i;
    logs.splice(real,1); save(); renderTable(); updateCharts(); updateProgress();
  }
});

dateInput.value = formatDate(new Date());
renderTable(); updateCharts(); updateProgress();
</script>
</body>
</html>
